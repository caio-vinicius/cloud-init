#cloud-config
autoinstall:
    version: 1
    identity:
        hostname: ubuntu-server
        password: "$6$exDY1mhS4KUYCE/2$zmn9ToZwTKLhCw.b4/b.ZRTIZM30JZ4QrOQ2aOXJ8yk96xpcCof0kxKwuX1kqLG/ygbJ1f8wxED22bTL4F46P0"
        username: ubuntu
    network:
        network:
            version: 2
            ethernets:
                ens192:
                    dhcp4: true
    storage:
        layout:
            name: lvm
    ssh:
        allow-pw: true
        install-server: true
        authorized-keys:
            - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBkKZwb7Avr9vcsUEgM8GHJv5wJJa65UwVX30WXRhk6N caio-projects@caio-pc
    write_files:
        - path: /etc/ssh/sshd_config
        content: |
            Port 4222
            Protocol 2
            HostKey /etc/ssh/ssh_host_rsa_key
            HostKey /etc/ssh/ssh_host_dsa_key
            HostKey /etc/ssh/ssh_host_ecdsa_key
            HostKey /etc/ssh/ssh_host_ed25519_key
            UsePrivilegeSeparation yes
            KeyRegenerationInterval 3600
            ServerKeyBits 1024
            SyslogFacility AUTH
            LogLevel INFO
            LoginGraceTime 120
            PermitRootLogin yes
            StrictModes no
            RSAAuthentication yes
            PubkeyAuthentication no
            IgnoreRhosts yes
            RhostsRSAAuthentication no
            HostbasedAuthentication no
            PermitEmptyPasswords no
            ChallengeResponseAuthentication no
            X11Forwarding yes
            X11DisplayOffset 10
            PrintMotd no
            PrintLastLog yes
            TCPKeepAlive yes
            AcceptEnv LANG LC_*
            Subsystem sftp /usr/lib/openssh/sftp-server
            UsePAM yes
            AllowUsers ubuntu
    user-data:
        disable_root: false
    late-commmands:
        - "echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/ubuntu"
        - "curtin in-target --target=/target -- chmod 440 /etc/sudoers.d/ubuntu"
